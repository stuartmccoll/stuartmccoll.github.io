<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Stuart McColl "><meta name=description content="AWS Lambda lets us run code without provisioning or managing servers, paying only for the compute time of the running code. There&amp;rsquo;s no permanent infrastructure, and the server only has a life cycle of 40 milliseconds. AWS provides automatic horizontal scaling for Lambda applications, spinning up and down as many instances as are necessary.
An open source Python library, Zappa gives us the ability to build and deploy serverless, event-driven Python applications on AWS Lambda."><meta name=keywords content="homepage,blog,development,programming"><meta name=robots content="noodp"><link rel=canonical href=https://stuartmccoll.github.io/posts/deploy-a-serverless-flask-application-with-aws-lambda/><title>Deploy a Serverless Flask Application with AWS Lambda :: Stuart McColl</title><link rel=stylesheet href=/main.min.15c204e66791e2f70ca06e7872b0ed743b4d2392b3c6dc31ba8dbd9f3d4618d2.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><meta name=theme-color content="#252627"><meta itemprop=name content="Deploy a Serverless Flask Application with AWS Lambda"><meta itemprop=description content="Deploy a Serverless Flask Application with AWS Lambda"><meta itemprop=datePublished content="2018-10-17T22:00:00+00:00"><meta itemprop=dateModified content="2018-10-17T22:00:00+00:00"><meta itemprop=wordCount content="537"><meta itemprop=image content="https://stuartmccoll.github.io"><meta itemprop=keywords content><meta property="article:published_time" content="2018-10-17 22:00:00 +0000 UTC"><script type=text/javascript>!function(b,d,a){var e=b.location,o="script",n="instrumentationKey",g="ingestionendpoint",k="disableExceptionTracking",i="ai.device.",j="toLowerCase",h="crossOrigin",l="POST",m="appInsightsSDK",f=a.name||"appInsights",c;(a.name||b[m])&&(b[m]=f),c=b[f]||function(f){var z=!1,q=!1,c={initialize:!0,queue:[],sv:"5",version:2,config:f},r,s,m,x,y,B,p,A;function w(b,f){var a={},d="Browser";return a[i+"id"]=d[j](),a[i+"type"]=d,a["ai.operation.name"]=e&&e.pathname||"_unknown_",a["ai.internal.sdkVersion"]="javascript:snippet_"+(c.sv||c.version),{time:function(){var a=new Date;function b(b){var a=""+b;return 1===a.length&&(a="0"+a),a}return a.getUTCFullYear()+"-"+b(1+a.getUTCMonth())+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"."+((a.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),iKey:b,name:"Microsoft.ApplicationInsights."+b.replace(/-/g,"")+"."+f,sampleRate:100,tags:a,data:{baseData:{ver:2}}}}if(r=f.url||a.src,r){function u(x){var h,i,t,u,v,s,o,p,k,d,m;z=!0,c.queue=[],q||(q=!0,h=r,o=function(){var a={},d=f.connectionString,e,b,c,h,i;if(d)for(e=d.split(";"),b=0;b<e.length;b++)c=e[b].split("="),2===c.length&&(a[c[0][j]()]=c[1]);return a[g]||(h=a.endpointsuffix,i=h?a.location:null,a[g]="https://"+(i?i+".":"")+"dc."+(h||"services.visualstudio.com")),a}(),p=o[n]||f[n]||"",k=o[g],d=k?k+"/v2/track":f.endpointUrl,(m=[]).push((i="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",t=h,u=d,(s=(v=w(p,"Exception")).data).baseType="ExceptionData",s.baseData.exceptions=[{typeName:"SDKLoadFailed",message:i.replace(/\./g,"-"),hasFullStack:!1,stack:i+"\nSnippet failed to load ["+t+"] -- Telemetry is disabled\nHelp Link: https://go.microsoft.com/fwlink/?linkid=2128109\nHost: "+(e&&e.pathname||"_unknown_")+"\nEndpoint: "+u,parsedStack:[]}],v)),m.push(function(g,f,d,e){var b=w(p,"Message"),c=b.data,a;return c.baseType="MessageData",a=c.baseData,a.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+d+")").replace(/\"/g,"")+'"',a.properties={endpoint:e},b}(0,0,h,d)),function(e,f){var d,c;JSON&&(d=b.fetch,d&&!a.useXhr?d(f,{method:l,body:JSON.stringify(e),mode:"cors"}):XMLHttpRequest&&(c=new XMLHttpRequest,c.open(l,f),c.setRequestHeader("Content-type","application/json"),c.send(JSON.stringify(e))))}(m,d))}function t(b,a){q||setTimeout(function(){!a&&c.core||u()},500)}s=function(){var b=d.createElement(o),c;return b.src=r,c=a[h],!c&&""!==c||"undefined"==b[h]||(b[h]=c),b.onload=t,b.onerror=u,b.onreadystatechange=function(c,a){"loaded"!==b.readyState&&"complete"!==b.readyState||t(0,a)},b}(),a.ld<0?d.getElementsByTagName("head")[0].appendChild(s):setTimeout(function(){d.getElementsByTagName(o)[0].parentNode.appendChild(s)},a.ld||0)}try{c.cookie=d.cookie}catch(a){}function v(a){for(;a.length;)!function(a){c[a]=function(){var b=arguments;z||c.queue.push(function(){c[a].apply(c,b)})}}(a.pop())}return m="track",x="TrackPage",y="TrackEvent",v([m+"Event",m+"PageView",m+"Exception",m+"Trace",m+"DependencyData",m+"Metric",m+"PageViewPerformance","start"+x,"stop"+x,"start"+y,"stop"+y,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),c.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4},B=(f.extensionConfig||{}).ApplicationInsightsAnalytics||{},!0!==f[k]&&!0!==B[k]&&(p="onerror",v(["_"+p]),A=b[p],b[p]=function(a,b,d,e,f){var g=A&&A(a,b,d,e,f);return!0!==g&&c["_"+p]({message:a,url:b,lineNumber:d,columnNumber:e,error:f}),g},f.autoExceptionInstrumented=!0),c}(a.cfg);function p(){a.onInit&&a.onInit(c)}(b[f]=c).queue&&0===c.queue.length?(c.queue.push(p),c.trackPageView({})):p()}(window,document,{src:"https://js.monitor.azure.com/scripts/b/ai.2.min.js",crossOrigin:"anonymous",cfg:{connectionString:"InstrumentationKey=74cc5c48-d066-4928-932e-459f438b579d;IngestionEndpoint=https://uksouth-1.in.applicationinsights.azure.com/;LiveEndpoint=https://uksouth.livediagnostics.monitor.azure.com/"}})</script></head><body><div class=container><header><section><h1 class=site-heading>Stuart McColl</h1><nav><ul><li><a href=/>Blog</a></li><li><a href=/about>About</a></li></ul></nav></section></header><hr><div class=content><main class=post><article><header><h1 class=post-title>Deploy a Serverless Flask Application with AWS Lambda</h1><p class=post-date>October 17, 17170</p></header><hr class=post-rule><div class=post-content><p><a href=https://aws.amazon.com/lambda/>AWS Lambda</a> lets us run code without provisioning or managing servers, paying only for the compute time of the running code. There&rsquo;s no permanent infrastructure, and the server only has a life cycle of 40 <em>milliseconds</em>. AWS provides automatic horizontal scaling for Lambda applications, spinning up and down as many instances as are necessary.</p><p>An open source Python library, <a href=https://github.com/Miserlou/Zappa>Zappa</a> gives us the ability to build and deploy serverless, event-driven Python applications on <a href=https://aws.amazon.com/lambda/>AWS Lambda</a>. Zappa works out of the box with WSGI web applications, such as Flask and Django.</p><p>It&rsquo;s quick and easy to deploy a Python WSGI application to AWS Lambda. The below guide assumes you have an AWS account and have created an IAM user with the relevant permissions.</p><h3 id=configuration>Configuration</h3><p>With <a href=https://pypi.org/project/pip/>pip</a> installed locally, we&rsquo;ll grab the <a href=https://pypi.org/project/awscli/>awscli</a> package.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>pip install awscli
</code></pre></div><p>Once installed, the <code>aws configure</code> command will be the quickest way to configure our AWS credentials.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>aws configure
</code></pre></div><p>This command will request four pieces of information.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>AWS Access Key ID <span class=o>[</span>None<span class=o>]</span>:
</code></pre></div><p>This is the AWS Access Key ID of our IAM user with the relevant permissions.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>AWS Secret Access Key <span class=o>[</span>None<span class=o>]</span>:
</code></pre></div><p>This is the AWS Secret Access Key of our IAM user with the relevant permissions.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>Default region name <span class=o>[</span>None<span class=o>]</span>:
</code></pre></div><p>This can be left blank, which will default this value to <code>us-east-1</code>.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>Default output format <span class=o>[</span>None<span class=o>]</span>:
</code></pre></div><p>This can also be left blank, which will default this value to <code>json</code>.</p><p>After running the command, the credentials will be stored in the AWS credentials file, located at <code>~/.aws/credentials</code>.</p><h3 id=deployment>Deployment</h3><p>First, we&rsquo;ll create a <code>requirements.txt</code> file which will document the <a href=https://pypi.org/project/pip/>pip</a> libraries our application will be dependent upon. Run the command below.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>touch requirements.txt
</code></pre></div><p>And then add the following to this file:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>awscli
flask
zappa
</code></pre></div><p><a href=https://github.com/Miserlou/Zappa>Zappa</a> needs a virtual environment to run, which we can create like so (after running <code>pip install virtualenv</code>):</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>virtualenv venv
</code></pre></div><p>That command will create our virtual environment in a new directory named <code>venv</code>. We can activate our virtual environment with the following command:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>source</span> venv/bin/activate
</code></pre></div><p>If we need to deactivate our virtual environment, we can do so by running the command <code>deactivate</code> or by exiting the terminal.</p><p>Once in the virtual environment, let&rsquo;s install the <a href=https://pypi.org/project/pip/>pip</a> libraries from our <code>requirements.txt</code> file.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>pip install -r requirements.txt
</code></pre></div><p>Our Flask application will sit in a file named <code>app.py</code>, which will serve one route that will return a JSON key/value pair.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>jsonify</span>


<span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>

<span class=nd>@app.route</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>index</span><span class=p>():</span>
  <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;response&#34;</span><span class=p>:</span> <span class=s2>&#34;Hello world&#34;</span><span class=p>})</span>

<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
  <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>()</span>
</code></pre></div><p>In order to deploy our application to AWS, we&rsquo;ll need to run a couple of Zappa commands. The following command begins an interactive process.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>zappa init
</code></pre></div><p>This will prompt us for a few different values, which we&rsquo;ll leave as their defaults.</p><p>The next command we&rsquo;ll run will tell Zappa to bundle and upload our application and it&rsquo;s dependencies. As part of this process, Zappa will create the necessary API gateways.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>zappa deploy dev
</code></pre></div><p>After running the above command, Zappa will return the URL where the application has been hosted. Hit this URL and we&rsquo;ll get back the following response:</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span><span class=nt>&#34;response&#34;</span><span class=p>:</span><span class=s2>&#34;Hello world&#34;</span><span class=p>}</span>
</code></pre></div><p>To remove the AWS Lambda function, and associated API gateway and Cloudwatch logs, we can run the <code>undeploy</code> command.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>zappa undeploy dev
</code></pre></div></div></article></main></div><hr><footer><section><h3>More</h3><ul><li><a href=https://hachyderm.io/@stuartmccoll rel=me>Contact me on Mastodon</a></li><li>Spotted a bug in the site?
<a href=https://github.com/stuartmccoll/hugo-theme-refresh/issues/new>Raise an issue on GitHub</a></li><li>Get notifications of new posts by
<a href=https://stuartmccoll.github.io/index.xml>subscribing to my RSS feed</a></li><li>This static site was generated using
<a href=https://github.com/gohugoio/hugo/releases/tag/v0.83.1>Hugo version 0.83.1</a></li></ul></section><hr><section><h3>Attribution</h3><p xmlns:dct=http://purl.org/dc/terms/ xmlns:cc=http://creativecommons.org/ns# class=license-text>This blog post <span rel=dct:title>(Deploy a Serverless Flask Application with AWS Lambda)</span> is licensed under
<a href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a>. Any code contained within
this article may be subject to other licenses.</p></section></footer></div></body></html>