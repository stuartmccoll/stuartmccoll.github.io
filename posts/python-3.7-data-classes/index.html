<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Stuart McColl "><meta name=description content="PEP 557 in the recently-released Python 3.7 added data classes to the standard Python library. Data classes can be thought of as mutable data holders and are somewhat similar to named tuples, although named tuples are immutable.
Data classes provide a lot of boilerplate code, saving time and effort on the part of the Python programmer, although it could be argued that this layer of abstraction makes debugging more difficult."><meta name=keywords content="homepage,blog,development,programming"><meta name=robots content="noodp"><link rel=canonical href=https://stuartmccoll.github.io/posts/python-3.7-data-classes/><title>Python 3.7 Data Classes :: Stuart McColl</title><link rel=stylesheet href=/main.min.15c204e66791e2f70ca06e7872b0ed743b4d2392b3c6dc31ba8dbd9f3d4618d2.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><meta name=theme-color content="#252627"><meta itemprop=name content="Python 3.7 Data Classes"><meta itemprop=description content="Python 3.7 Data Classes"><meta itemprop=datePublished content="2018-07-08T19:50:00+00:00"><meta itemprop=dateModified content="2018-07-08T19:50:00+00:00"><meta itemprop=wordCount content="1419"><meta itemprop=image content="https://stuartmccoll.github.io"><meta itemprop=keywords content><meta property="article:published_time" content="2018-07-08 19:50:00 +0000 UTC"><script type=text/javascript>!function(b,d,a){var e=b.location,o="script",n="instrumentationKey",g="ingestionendpoint",k="disableExceptionTracking",i="ai.device.",j="toLowerCase",h="crossOrigin",l="POST",m="appInsightsSDK",f=a.name||"appInsights",c;(a.name||b[m])&&(b[m]=f),c=b[f]||function(f){var z=!1,q=!1,c={initialize:!0,queue:[],sv:"5",version:2,config:f},r,s,m,x,y,B,p,A;function w(b,f){var a={},d="Browser";return a[i+"id"]=d[j](),a[i+"type"]=d,a["ai.operation.name"]=e&&e.pathname||"_unknown_",a["ai.internal.sdkVersion"]="javascript:snippet_"+(c.sv||c.version),{time:function(){var a=new Date;function b(b){var a=""+b;return 1===a.length&&(a="0"+a),a}return a.getUTCFullYear()+"-"+b(1+a.getUTCMonth())+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"."+((a.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),iKey:b,name:"Microsoft.ApplicationInsights."+b.replace(/-/g,"")+"."+f,sampleRate:100,tags:a,data:{baseData:{ver:2}}}}if(r=f.url||a.src,r){function u(x){var h,i,t,u,v,s,o,p,k,d,m;z=!0,c.queue=[],q||(q=!0,h=r,o=function(){var a={},d=f.connectionString,e,b,c,h,i;if(d)for(e=d.split(";"),b=0;b<e.length;b++)c=e[b].split("="),2===c.length&&(a[c[0][j]()]=c[1]);return a[g]||(h=a.endpointsuffix,i=h?a.location:null,a[g]="https://"+(i?i+".":"")+"dc."+(h||"services.visualstudio.com")),a}(),p=o[n]||f[n]||"",k=o[g],d=k?k+"/v2/track":f.endpointUrl,(m=[]).push((i="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",t=h,u=d,(s=(v=w(p,"Exception")).data).baseType="ExceptionData",s.baseData.exceptions=[{typeName:"SDKLoadFailed",message:i.replace(/\./g,"-"),hasFullStack:!1,stack:i+"\nSnippet failed to load ["+t+"] -- Telemetry is disabled\nHelp Link: https://go.microsoft.com/fwlink/?linkid=2128109\nHost: "+(e&&e.pathname||"_unknown_")+"\nEndpoint: "+u,parsedStack:[]}],v)),m.push(function(g,f,d,e){var b=w(p,"Message"),c=b.data,a;return c.baseType="MessageData",a=c.baseData,a.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+d+")").replace(/\"/g,"")+'"',a.properties={endpoint:e},b}(0,0,h,d)),function(e,f){var d,c;JSON&&(d=b.fetch,d&&!a.useXhr?d(f,{method:l,body:JSON.stringify(e),mode:"cors"}):XMLHttpRequest&&(c=new XMLHttpRequest,c.open(l,f),c.setRequestHeader("Content-type","application/json"),c.send(JSON.stringify(e))))}(m,d))}function t(b,a){q||setTimeout(function(){!a&&c.core||u()},500)}s=function(){var b=d.createElement(o),c;return b.src=r,c=a[h],!c&&""!==c||"undefined"==b[h]||(b[h]=c),b.onload=t,b.onerror=u,b.onreadystatechange=function(c,a){"loaded"!==b.readyState&&"complete"!==b.readyState||t(0,a)},b}(),a.ld<0?d.getElementsByTagName("head")[0].appendChild(s):setTimeout(function(){d.getElementsByTagName(o)[0].parentNode.appendChild(s)},a.ld||0)}try{c.cookie=d.cookie}catch(a){}function v(a){for(;a.length;)!function(a){c[a]=function(){var b=arguments;z||c.queue.push(function(){c[a].apply(c,b)})}}(a.pop())}return m="track",x="TrackPage",y="TrackEvent",v([m+"Event",m+"PageView",m+"Exception",m+"Trace",m+"DependencyData",m+"Metric",m+"PageViewPerformance","start"+x,"stop"+x,"start"+y,"stop"+y,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),c.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4},B=(f.extensionConfig||{}).ApplicationInsightsAnalytics||{},!0!==f[k]&&!0!==B[k]&&(p="onerror",v(["_"+p]),A=b[p],b[p]=function(a,b,d,e,f){var g=A&&A(a,b,d,e,f);return!0!==g&&c["_"+p]({message:a,url:b,lineNumber:d,columnNumber:e,error:f}),g},f.autoExceptionInstrumented=!0),c}(a.cfg);function p(){a.onInit&&a.onInit(c)}(b[f]=c).queue&&0===c.queue.length?(c.queue.push(p),c.trackPageView({})):p()}(window,document,{src:"https://js.monitor.azure.com/scripts/b/ai.2.min.js",crossOrigin:"anonymous",cfg:{connectionString:"InstrumentationKey=74cc5c48-d066-4928-932e-459f438b579d;IngestionEndpoint=https://uksouth-1.in.applicationinsights.azure.com/;LiveEndpoint=https://uksouth.livediagnostics.monitor.azure.com/"}})</script></head><body><div class=container><header><section><h1 class=site-heading>Stuart McColl</h1><nav><ul><li><a href=/>Blog</a></li><li><a href=/about>About</a></li></ul></nav></section></header><hr><div class=content><main class=post><article><header><h1 class=post-title>Python 3.7 Data Classes</h1><p class=post-date>July 8, 8080</p></header><hr class=post-rule><div class=post-content><p><a href=https://www.python.org/dev/peps/pep-0557/>PEP 557</a> in the recently-released <a href=https://www.python.org/downloads/release/python-370/>Python 3.7</a> added data classes to the standard Python library. Data classes can be thought of as mutable data holders and are somewhat similar to <a href=https://docs.python.org/2/library/collections.html#collections.namedtuple>named tuples</a>, although named tuples are immutable.</p><p>Data classes provide a lot of boilerplate code, saving time and effort on the part of the Python programmer, although it could be argued that this layer of abstraction makes debugging more difficult.</p><h2 id=comparing-regular-classes-and-data-classes>Comparing regular classes and data classes</h2><p>Consider the following class:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>class</span> <span class=nc>BankAccount</span><span class=p>():</span>
  <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=nb>id</span><span class=p>,</span> <span class=n>balance</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>):</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>id</span> <span class=o>=</span> <span class=nb>id</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>=</span> <span class=n>balance</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>customer_id</span> <span class=o>=</span> <span class=n>customer_id</span>
</code></pre></div><p>This provides us with the minimal ability to initialise a new BankAccount object, although we&rsquo;ve had to reference <code>id</code>, <code>balance</code>, and <code>customer_id</code> three times in this small piece of code.</p><p>Let&rsquo;s initialise two new objects using our <code>BankAccount</code> class - <code>my_account</code> and <code>your_account</code>. We&rsquo;ll initialise both with the same values, ignoring the fact that they should have different <code>id</code> and <code>customer_id</code> values, then try and compare them to each other.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>my_account</span> <span class=o>=</span> <span class=n>BankAccount</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>your_account</span> <span class=o>=</span> <span class=n>BankAccount</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>my_account</span> <span class=o>==</span> <span class=n>your_account</span>
<span class=bp>False</span>
</code></pre></div><p>In order to be able to compare our <code>my_account</code> and <code>your_account</code> objects successfully, we&rsquo;d need to add an <code>__eq__</code> method to our class.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>class</span> <span class=nc>BankAccount</span><span class=p>():</span>
  <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=nb>id</span><span class=p>,</span> <span class=n>balance</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>):</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>id</span> <span class=o>=</span> <span class=nb>id</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>=</span> <span class=n>balance</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>customer_id</span> <span class=o>=</span> <span class=n>customer_id</span>

  <span class=k>def</span> <span class=fm>__eq__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>):</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span> <span class=ow>is</span> <span class=n>other</span><span class=o>.</span><span class=vm>__class__</span><span class=p>:</span>
      <span class=k>return</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>balance</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>customer_id</span><span class=p>)</span> <span class=o>==</span> <span class=p>(</span><span class=n>other</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>other</span><span class=o>.</span><span class=n>balance</span><span class=p>,</span> <span class=n>other</span><span class=o>.</span><span class=n>customer_id</span><span class=p>)</span>
    <span class=k>return</span> <span class=bp>NotImplemented</span>
</code></pre></div><p>If we initialise our two objects again and compare them now, we&rsquo;ll get the <code>True</code> response that we&rsquo;re expecting. If we were to initialise the <code>your_account</code> object with an <code>id</code> value of <code>2</code>, and a <code>customer_id</code> value of <code>2</code>, we&rsquo;d get the correct response of <code>False</code> when comparing the two objects.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>my_account</span> <span class=o>=</span> <span class=n>BankAccount</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>your_account</span> <span class=o>=</span> <span class=n>BankAccount</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>my_account</span> <span class=o>==</span> <span class=n>your_account</span>
<span class=bp>True</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>your_account</span> <span class=o>=</span> <span class=n>BankAccount</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>my_account</span> <span class=o>==</span> <span class=n>your_account</span>
<span class=bp>False</span>
</code></pre></div><p>This all makes sense so far, but it&rsquo;s boilerplate code that we have to write each and every time that we write a new class. Let&rsquo;s take a look at how we&rsquo;d do the same thing with 3.7&rsquo;s data classes.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>

<span class=nd>@dataclass</span>
<span class=k>class</span> <span class=nc>DataClassBankAccount</span><span class=p>():</span>
  <span class=nb>id</span><span class=p>:</span> <span class=nb>int</span>
  <span class=n>balance</span><span class=p>:</span> <span class=nb>int</span>
  <span class=n>customer_id</span><span class=p>:</span> <span class=nb>int</span>
</code></pre></div><p>Data classes generate all of this boilerplate code for us, but they don&rsquo;t stop at just the <code>__init__</code> and <code>__eq__</code> methods - they can also generate <code>__repr__</code>, <code>__ne__</code>, <code>__lt__</code>, <code>__le__</code>, <code>__gt__</code>, and <code>__ge__</code> methods too, if the <code>order</code> parameter is specified as <code>True</code> (this is done at the <code>@dataclass</code> level, i.e. <code>@dataclass(order=True)</code>). Additional methods can be added to the data class as you would for a normal class. The <code>@dataclass</code> decorator inspects a class definition for fields with type annotations (added in <a href=https://www.python.org/dev/peps/pep-0526/>PEP 526</a>). These type annotations are <em>mandatory</em> when creating data classes as fields without type annotations will simply be ignored. We can now initialise and compare our two objects straight away:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>my_account</span> <span class=o>=</span> <span class=n>DataClassBankAccount</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>your_account</span> <span class=o>=</span> <span class=n>DataClassBankAccount</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>my_account</span> <span class=o>==</span> <span class=n>your_account</span>
<span class=bp>True</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>your_account</span> <span class=o>=</span> <span class=n>DataClassBankAccount</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>my_account</span> <span class=o>==</span> <span class=n>your_account</span>
<span class=bp>False</span>
</code></pre></div><p>As mentioned in <a href=https://www.python.org/dev/peps/pep-0557/>PEP 557</a>, there isn&rsquo;t anything special about these classes. The decorator takes the class and adds generated methods to it, then returns the class it was given. This means adding your own methods to a data class is done in exactly the same way as you would for a regular class.</p><h2 id=comparing-named-tuples-and-data-classes>Comparing named tuples and data classes</h2><p>Let&rsquo;s compare for a moment our bank account data class and an implementation of the bank account using a named tuple.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>NamedTuple</span>

<span class=k>class</span> <span class=nc>NamedTupleBankAccount</span><span class=p>(</span><span class=n>NamedTuple</span><span class=p>):</span>
  <span class=nb>id</span><span class=p>:</span> <span class=nb>int</span>
  <span class=n>balance</span><span class=p>:</span> <span class=nb>int</span>
  <span class=n>customer_id</span><span class=p>:</span> <span class=nb>int</span>
</code></pre></div><p>There&rsquo;s no great difference here, other than the fact that our data class was described using a decorator, whilst the named tuple subclasses <code>NamedTuple</code>. There are other similarities too. For instance, with our data class we can create a new object from an existing data class object.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>replace</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>replace</span><span class=p>(</span><span class=n>my_account</span><span class=p>,</span> <span class=n>balance</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
<span class=n>BankAccount</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>balance</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span> <span class=n>customer_id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div><p>We&rsquo;d do this in a similar way with a named tuple, but the replace method here is proceded by an underscore, indicating that it is a private method of our named tuple bank account object.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>our_account</span> <span class=o>=</span> <span class=n>NamedTupleBankAccount</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>our_account</span><span class=o>.</span><span class=n>_replace</span><span class=p>(</span><span class=n>balance</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
<span class=n>NamedTupleBankAccount</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>balance</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span> <span class=n>customer_id</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</code></pre></div><p>Data classes also provide methods for conversion to dictionaries and tuples.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>asdict</span><span class=p>,</span> <span class=n>astuple</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>asdict</span><span class=p>(</span><span class=n>my_account</span><span class=p>)</span>
<span class=p>{</span><span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;balance&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>astuple</span><span class=p>(</span><span class=n>my_account</span><span class=p>)</span>
<span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</code></pre></div><p>And similarly, the <code>asdict</code> method exists as a private method of our named tuple object, with the key difference being that this returns an <code>OrderedDict</code> rather than a standard dict.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>our_account</span><span class=o>.</span><span class=n>_asdict</span><span class=p>()</span>
<span class=n>OrderedDict</span><span class=p>([(</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=mi>3</span><span class=p>),</span> <span class=p>(</span><span class=s1>&#39;balance&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=p>(</span><span class=s1>&#39;customer_id&#39;</span><span class=p>,</span> <span class=mi>3</span><span class=p>)])</span>
</code></pre></div><p>You can unpack a named tuple rather simply, but must first wrap a data class object in a call to <code>astuple</code> before it is possible to unpack - this is because data classes don&rsquo;t iterate by default.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>our_account_id</span><span class=p>,</span> <span class=n>our_balance</span><span class=p>,</span> <span class=n>our_customer_id</span> <span class=o>=</span> <span class=n>our_account</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>our_account_id</span>
<span class=mi>3</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>my_account_id</span><span class=p>,</span> <span class=n>my_balance</span><span class=p>,</span> <span class=n>my_customer_id</span> <span class=o>=</span> <span class=n>astuple</span><span class=p>(</span><span class=n>my_account</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>my_account_id</span>
<span class=mi>1</span>
</code></pre></div><p>Data classes can&rsquo;t be hashed by default, whereas named tuples can - data classes actually set <code>__hash__</code> to <code>None</code> in order to avoid accidental hashability. Named tuples provide hashability and ordering out of the box, as they are inherited from tuples.</p><p>Equality methods between the two types are different as well. It&rsquo;s possible to compare two different named tuple objects instantiated from two different named tuple classes which happen to have the same field naming - this is because named tuples lack the <code>if self.__class__ is other.__class__:</code> conditional that data classes provide in their equality methods.</p><p>As of Python 3.7 it is slower to access fields of a named tuple than those of a data class, though <a href=https://twitter.com/raymondh>Raymond Hettinger</a> mentions in his PyCon 2018 talk &lsquo;<a href="https://www.youtube.com/watch?v=T-TwcmT6Rcw">Dataclasses: The code generator to end all code generators</a>&rsquo; that this timing will be improved significantly in Python 3.8. You can find the slides for Raymond&rsquo;s PyCon talk <a href=https://twitter.com/raymondh/status/995693882812915712>here</a>.</p><p>You shouldn&rsquo;t think of data classes as an improvement upon a named tuple - if that&rsquo;s what fits the structure of your data, then that&rsquo;s what you should use.</p><h2 id=additional-data-class-usages>Additional data class usages</h2><h3 id=default-values>Default values</h3><p>We can set default values for our specified data class fields. Let&rsquo;s take a look at how we&rsquo;d do that with a normal class.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>class</span> <span class=nc>Animal</span><span class=p>:</span>
  <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=nb>type</span><span class=p>,</span> <span class=n>legs</span><span class=o>=</span><span class=mi>4</span><span class=p>):</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>type</span> <span class=o>=</span> <span class=nb>type</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>legs</span> <span class=o>=</span> <span class=n>legs</span>
</code></pre></div><p>When declaring our data class, we declare our default value(s) differently.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=nd>@dataclass</span>
<span class=k>class</span> <span class=nc>Animal</span><span class=p>:</span>
  <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span>
  <span class=n>legs</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>4</span>
</code></pre></div><p>The above data class will give the below output when initialising objects.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>Animal</span><span class=p>(</span><span class=s2>&#34;dog&#34;</span><span class=p>)</span>
<span class=n>Animal</span><span class=p>(</span><span class=nb>type</span><span class=o>=</span><span class=s2>&#34;dog&#34;</span><span class=p>,</span> <span class=n>legs</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>Animal</span><span class=p>(</span><span class=s2>&#34;ostrich&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
<span class=n>Animal</span><span class=p>(</span><span class=nb>type</span><span class=o>=</span><span class=s2>&#34;ostrich&#34;</span><span class=p>,</span> <span class=n>legs</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</code></pre></div><p>Building upon our original BankAccount class we can take a look at a more advanced default value. Let&rsquo;s say for each bank account object, we want to track who accessed the bank account and when. We&rsquo;ll create a more advanced BankAccount class that features this functionality.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>dataclass</span> <span class=kn>import</span> <span class=n>field</span>
<span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>

<span class=nd>@dataclass</span>
<span class=k>class</span> <span class=nc>AdvancedBankAccount</span><span class=p>():</span>
  <span class=nb>id</span><span class=p>:</span> <span class=nb>int</span>
  <span class=n>balance</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=n>metadata</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;currency&#34;</span><span class=p>:</span> <span class=s2>&#34;GBP&#34;</span><span class=p>})</span>
  <span class=n>customer_id</span><span class=p>:</span> <span class=nb>int</span>
  <span class=n>accessed_by</span><span class=p>:</span> <span class=nb>list</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>)</span>

  <span class=k>def</span> <span class=nf>access</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>accessor_id</span><span class=p>):</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>accessed_by</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>accessor_id</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()))</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>advanced_account</span> <span class=o>=</span> <span class=n>AdvancedBankAccount</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>10000</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>advanced_account</span><span class=o>.</span><span class=n>access</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>advanced_account</span>
<span class=n>AdvancedBankAccount</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>balance</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span> <span class=n>customer_id</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>accessed_by</span><span class=o>=</span><span class=p>[(</span><span class=mi>1</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2018</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>19</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>40</span><span class=p>,</span> <span class=mi>783467</span><span class=p>))])</span>
</code></pre></div><p>The <code>default_factory</code> is used to provide a mutable default value. Additionally, we&rsquo;ve also passed a metadata parameter which specifies some metadata about the field, in this case the currency of the <code>balance</code>. The dataclass itself won&rsquo;t do anything with this, but you can view it using the <code>fields</code> function.</p><h3 id=field-arguments>Field arguments</h3><p>We can pass some additional arguments when creating our data classes.</p><p>We can not include a specific field in the output of the class <code>__repr__</code> method.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>field</span>

<span class=nd>@dataclass</span>
<span class=k>class</span> <span class=nc>Animal</span><span class=p>():</span>
  <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=nb>repr</span><span class=o>=</span><span class=bp>False</span><span class=p>)</span>
  <span class=n>legs</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>4</span>
</code></pre></div><p>And we could also not include a specific field when comparing two objects from the same data class.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>field</span>

<span class=nd>@dataclass</span>
<span class=k>class</span> <span class=nc>Animal</span><span class=p>():</span>
  <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=n>order</span><span class=o>=</span><span class=bp>False</span><span class=p>)</span>
  <span class=n>legs</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>4</span>
</code></pre></div><h3 id=immutable-data-classes>Immutable data classes</h3><p>Data classes are mutable by default, but there might be scenarios where we want to maintain the immutability that a named tuple offers us.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>field</span>

<span class=nd>@dataclass</span><span class=p>(</span><span class=n>frozen</span><span class=o>=</span><span class=bp>True</span><span class=p>)</span>
<span class=k>class</span> <span class=nc>Animal</span><span class=p>():</span>
  <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span>
  <span class=n>legs</span><span class=p>:</span> <span class=nb>int</span>
</code></pre></div><p>The <code>frozen=True</code> argument that we&rsquo;ve passed to the <code>@dataclass</code> decorator means that we won&rsquo;t be able to assign values to any objects created from this data class after their initialisation.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>cat</span> <span class=o>=</span> <span class=n>Animal</span><span class=p>(</span><span class=s2>&#34;cat&#34;</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>cat</span><span class=o>.</span><span class=n>legs</span> <span class=o>=</span> <span class=mi>3</span>
<span class=n>dataclasses</span><span class=o>.</span><span class=n>FrozenInstanceError</span><span class=p>:</span> <span class=n>cannot</span> <span class=n>assign</span> <span class=n>to</span> <span class=n>field</span> <span class=s1>&#39;legs&#39;</span>
</code></pre></div><h2 id=further-reading>Further reading</h2><ul><li><a href=https://www.python.org/dev/peps/pep-0557/>PEP557</a></li><li><a href="https://www.youtube.com/watch?v=T-TwcmT6Rcw">Dataclasses: The code generator to end all code generators</a></li></ul></div></article></main></div><hr><footer><section><h3>More</h3><ul><li><a href=https://hachyderm.io/@stuartmccoll rel=me>Contact me on Mastodon</a></li><li>Spotted a bug in the site?
<a href=https://github.com/stuartmccoll/hugo-theme-refresh/issues/new>Raise an issue on GitHub</a></li><li>Get notifications of new posts by
<a href=https://stuartmccoll.github.io/index.xml>subscribing to my RSS feed</a></li><li>This static site was generated using
<a href=https://github.com/gohugoio/hugo/releases/tag/v0.83.1>Hugo version 0.83.1</a></li></ul></section><hr><section><h3>Attribution</h3><p xmlns:dct=http://purl.org/dc/terms/ xmlns:cc=http://creativecommons.org/ns# class=license-text>This blog post <span rel=dct:title>(Python 3.7 Data Classes)</span> is licensed under
<a href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a>. Any code contained within
this article may be subject to other licenses.</p></section></footer></div></body></html>