<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Stuart McColl "><meta name=description content="Microsoft Graph API has largely superceded v1 of the SharePoint REST API for API-driven interaction with SharePoint online, but there are still a few things that you can&amp;rsquo;t do with it. For example, at the time of writing, it&amp;rsquo;s not possible to use Microsoft Graph API to add attachments to a list item, or retrieve attachments from an existing list item. The legacy SharePoint REST API does allow for this functionality."><meta name=keywords content="homepage,blog,development,programming"><meta name=robots content="noodp"><link rel=canonical href=https://stuartmccoll.github.io/posts/2020-06-16-sharepoint-api-authentication-with-postman/><title>Microsoft SharePoint API Access with Postman :: Stuart McColl</title><link rel=stylesheet href=/main.min.204e05be3bf8f06e400f4478e75c46ae9e3015935b7dd6625b19338e6625499b.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><meta name=theme-color content="#252627"><meta itemprop=name content="Microsoft SharePoint API Access with Postman"><meta itemprop=description content="Microsoft Graph API has largely superceded v1 of the SharePoint REST API for API-driven interaction with SharePoint online, but there are still a few things that you can&rsquo;t do with it. For example, at the time of writing, it&rsquo;s not possible to use Microsoft Graph API to add attachments to a list item, or retrieve attachments from an existing list item. The legacy SharePoint REST API does allow for this functionality."><meta itemprop=datePublished content="2020-06-16T21:30:00+01:00"><meta itemprop=dateModified content="2020-06-16T21:30:00+01:00"><meta itemprop=wordCount content="848"><meta itemprop=image content="https://stuartmccoll.github.io"><meta itemprop=keywords content="microsoft,sharepoint,api,postman,"><meta property="article:published_time" content="2020-06-16 21:30:00 +0100 +0100"></head><body><div class=container><header><section><h1 class=site-heading>Stuart McColl</h1><nav><ul><li><a href=/>Blog</a></li><li><a href=/about>About</a></li></ul></nav></section></header><hr><div class=content><main class=post><article><header><h1 class=post-title>Microsoft SharePoint API Access with Postman</h1><p class=post-date>June 16, 2020</p></header><hr class=post-rule><div class=post-content><p><a href=https://developer.microsoft.com/en-us/graph/>Microsoft Graph API</a> has largely superceded <a href="https://docs.microsoft.com/en-us/sharepoint/dev/sp-add-ins/get-to-know-the-sharepoint-rest-service?tabs=csom">v1 of the SharePoint REST API</a> for API-driven interaction with SharePoint online, but there are still a few things that you can&rsquo;t do with it. For example, at the time of writing, it&rsquo;s not possible to use Microsoft Graph API to add attachments to a list item, or retrieve attachments from an existing list item. The legacy SharePoint REST API <em>does</em> allow for this functionality. Authentication with the Graph API and the legacy SharePoint REST API also differs - the following acts as a tutorial for configuring interaction with the legacy SharePoint REST API using <a href=https://www.postman.com>Postman</a>.</p><p>For my SharePoint setup, I&rsquo;ve used a developer subscription from the <a href=https://developer.microsoft.com/en-us/microsoft-365/dev-program>Microsoft 365 Developer Program</a>. This allows me to administrate my own free SharePoint configuration, add pre-configured users from a sample data pack, and more.</p><hr><p>Ultimately, what we&rsquo;re trying to do is get an access token which will allow Postman authorised access to SharePoint. There are some steps we need to carry out first.</p><h2 id=register-a-sharepoint-add-in>Register a SharePoint Add-In</h2><p>To authorise our external system - in this case Postman, but it could also be an external application - SharePoint needs to know about it.</p><p>To begin, login to your SharePoint site. Then, access the following URL (where <code>contoso</code> is your own tenant name):</p><div class=highlight><pre class=chroma><code class=language-http data-lang=http><span class=err>https://contoso.sharepoint.com/_layouts/15/appregnew.aspx
</span></code></pre></div><p>This page allows us to register our SharePoint Add-In. You should see five input fields - <code>Client Id</code>, <code>Client Secret</code>, <code>Title</code>, <code>App Domain</code>, <code>Redirect URI</code>. Click the &lsquo;Generate&rsquo; button next to both &lsquo;Client Id&rsquo; and &lsquo;Client Secret&rsquo;, then make a note of the values populated - we&rsquo;ll need these later. You can enter anything in &lsquo;Title&rsquo; - we&rsquo;ll go with &lsquo;Postman&rsquo; for now. &lsquo;App Domain&rsquo; should be <code>localhost</code> and &lsquo;Redirect URI&rsquo; should be <code>https://localhost</code>. Click the &lsquo;Create&rsquo; button. You should see a success message returned, with the information you added to the input fields.</p><h2 id=grant-permissions-to-a-sharepoint-add-in>Grant permissions to a SharePoint Add-In</h2><p>Assuming you&rsquo;re still logged into your SharePoint site, access the following URL (again, where <code>contoso</code> is your own tenant name):</p><div class=highlight><pre class=chroma><code class=language-http data-lang=http><span class=err>https://contoso.sharepoint.com/_layouts/15/appinv.aspx
</span></code></pre></div><p>We can use this page to grant different permissions to any registered SharePoint Add-Ins. Paste the &lsquo;Client Id&rsquo; that we generated when registering our Add-In into the &lsquo;App Id&rsquo; field, and then click the &lsquo;Lookup&rsquo; button. This should prepopulate the other fields on the page. However, it won&rsquo;t populate the &lsquo;Permission Request XML&rsquo; field. In this field, paste the following XML:</p><div class=highlight><pre class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;AppPermissionRequests</span> <span class=na>AllowAppOnlyPolicy=</span><span class=s>&#34;true&#34;</span><span class=nt>&gt;</span>
    <span class=nt>&lt;AppPermissionRequest</span> <span class=na>Scope=</span><span class=s>&#34;http://sharepoint/content/sitecollection/web&#34;</span> <span class=na>Right=</span><span class=s>&#34;FullControl&#34;</span> <span class=nt>/&gt;</span>
<span class=nt>&lt;/AppPermissionRequests&gt;</span>
</code></pre></div><p>This will grant our Add-In full permissions on our SharePoint site. Your use case may call for more granular permissions. If that&rsquo;s the case, see <a href=https://docs.microsoft.com/en-us/sharepoint/dev/sp-add-ins/add-in-permissions-in-sharepoint>this Microsoft documentation</a> for details on how to adapt this XML to be more granular.</p><p>Once you&rsquo;re happy with the XML that will grant permissions to our SharePoint Add-In, click the &lsquo;Create&rsquo; button. You&rsquo;ll see a screen asking if you trust the Add-In - click &lsquo;Trust it&rsquo;.</p><h2 id=creating-a-postman-environment>Creating a Postman environment</h2><p>Within Postman, you&rsquo;ll see a dropdown in the top right corner of the screen containing the words <code>No Environment</code>. Next to this is an eye icon - click this to bring up a list of variables local to the environment and a list of global environment variables. Depending on your prior usage, you might see different things here. Click &lsquo;Add&rsquo; in the top right corner.</p><p>Enter a descriptive environment name - such as <code>Microsoft SharePoint REST API</code>. In the table below, we&rsquo;re going to add five environment variables - enter the values in the &lsquo;Initial Value&rsquo; column.</p><p><code>appReg_clientId</code> should contain our &lsquo;Client Id&rsquo; for our SharePoint Add-In.</p><p><code>appReg_clientSecret</code> should contain our &lsquo;Client Secret&rsquo; for our SharePoint Add-In.</p><p><code>targetHost</code> should contain <code>contoso.sharepoint.com</code> where <code>contoso</code> is your own tenant name.</p><p><code>principal</code> should contain <code>00000003-0000-0ff1-ce00-000000000000</code>.</p><p><code>realm</code> should contain your tenant ID.</p><p>To find your tenant ID, you can send a <code>GET</code> request to (where <code>contoso</code> is your own tenant name):</p><div class=highlight><pre class=chroma><code class=language-http data-lang=http><span class=err>https://contoso.sharepoint.com/_vti_bin/client.svc/
</span></code></pre></div><p>You&rsquo;ll receive a <code>System.UnauthorizedAccessException</code> in the response body, but we&rsquo;re interested in the headers here. Inside the <code>WWW-Authenticate</code> header, you&rsquo;ll see <code>Bearer realm="&lt;GUID>"...</code>. The GUID value is your tenant ID, which you&rsquo;ll want to set as the value of <code>realm</code> in our environment variables.</p><p>Be careful here to check that the &lsquo;Current Value&rsquo; column for each environment variable doesn&rsquo;t contain a new line at the end of each value. If it does, it&rsquo;ll stop us from being able to use these environment variables correctly.</p><p>With that done, click &lsquo;Add&rsquo; to save our Postman environment.</p><h2 id=requesting-an-access-token>Requesting an access token</h2><p>Let&rsquo;s create a new Postman request, with an HTTP method of <code>POST</code>. Our URL should be:</p><div class=highlight><pre class=chroma><code class=language-http data-lang=http><span class=err>https://accounts.accesscontrol.windows.net/{{realm}}/tokens/OAuth/2
</span></code></pre></div><p>The <code>{{realm}}</code> in the middle of the URL will pull from our <code>realm</code> environment variable.</p><p>In the &lsquo;Body&rsquo; section, select <code>x-www-form-urlencoded</code>. We&rsquo;re going to create four key/value pairs.</p><p><code>grant_type</code> should have a value of <code>client_credentials</code>.</p><p><code>client_id</code> should have a value of <code>{{appReg_clientId}}@{{realm}}</code>.</p><p><code>client_secret</code> should have a value of <code>{{appReg_clientSecret}}</code>.</p><p>Finally, <code>resource</code>, should have a value of <code>{{principal}}/{{targetHost}}@{{realm}}</code>.</p><p>Now, click &lsquo;Send&rsquo; and the SharePoint REST API will respond with an access token that can be used in future requests to the API. We&rsquo;ll use this in a future tutorial to create new list items with attachments.</p></div></article></main></div><hr><footer><section><h3>More</h3><ul><li><a href=https://hachyderm.io/@stuartmccoll rel=me>Contact me on Mastodon</a></li><li>Spotted a bug in the site?
<a href=https://github.com/stuartmccoll/hugo-theme-refresh/issues/new>Raise an issue on GitHub</a></li><li>Get notifications of new posts by
<a href=https://stuartmccoll.github.io/index.xml>subscribing to my RSS feed</a></li><li>This static site was generated using
<a href=https://github.com/gohugoio/hugo/releases/tag/v0.83.1>Hugo version 0.83.1</a></li></ul></section><hr><section><h3>Attribution</h3><p xmlns:dct=http://purl.org/dc/terms/ xmlns:cc=http://creativecommons.org/ns# class=license-text>This blog post <span rel=dct:title>(Microsoft SharePoint API Access with Postman)</span> is licensed under
<a href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a>. Any code contained within
this article may be subject to other licenses.</p></section></footer></div></body></html>