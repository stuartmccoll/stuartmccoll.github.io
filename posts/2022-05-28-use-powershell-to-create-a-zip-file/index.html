<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Stuart McColl "><meta name=description content="A simple automation need that I stumbled across recently was the ability to quickly create a .zip file from a static set of files and directories. Rather than run a long command in PowerShell each time, I bundled everything up into a quick function that I can run using New-StaticZipFile.
The Compress-Archive cmdlet lets us create a compressed, or zipped, archive file. There are limitations (e.g. maximum file size is 2GB) to this cmdlet, as well as more advanced options, such as the level of compression needed, but we&amp;rsquo;ll be keeping it really simple here."><meta name=keywords content="homepage,blog,development,programming"><meta name=robots content="noodp"><link rel=canonical href=https://stuartmccoll.github.io/posts/2022-05-28-use-powershell-to-create-a-zip-file/><title>Use PowerShell to create a .zip file :: Stuart McColl</title><link rel=stylesheet href=/main.min.15c204e66791e2f70ca06e7872b0ed743b4d2392b3c6dc31ba8dbd9f3d4618d2.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><meta name=theme-color content="#252627"><meta itemprop=name content="Use PowerShell to create a .zip file"><meta itemprop=description content="A simple automation need that I stumbled across recently was the ability to quickly create a .zip file from a static set of files and directories. Rather than run a long command in PowerShell each time, I bundled everything up into a quick function that I can run using New-StaticZipFile.
The Compress-Archive cmdlet lets us create a compressed, or zipped, archive file. There are limitations (e.g. maximum file size is 2GB) to this cmdlet, as well as more advanced options, such as the level of compression needed, but we&rsquo;ll be keeping it really simple here."><meta itemprop=datePublished content="2022-05-28T11:30:00+01:00"><meta itemprop=dateModified content="2022-05-28T11:30:00+01:00"><meta itemprop=wordCount content="482"><meta itemprop=image content="https://stuartmccoll.github.io"><meta itemprop=keywords content="PowerShell,"><meta property="article:section" content="Automation"><meta property="article:section" content="PowerShell"><meta property="article:published_time" content="2022-05-28 11:30:00 +0100 +0100"></head><body><div class=container><header><section><h1 class=site-heading>Stuart McColl</h1><nav><ul><li><a href=/>Blog</a></li><li><a href=/about>About</a></li></ul></nav></section></header><hr><div class=content><main class=post><article><header><h1 class=post-title>Use PowerShell to create a .zip file</h1><p class=post-date>May 28, 2022</p></header><hr class=post-rule><div class=post-content><p>A simple automation need that I stumbled across recently was the ability to
quickly create a <code>.zip</code> file from a static set of files and directories. Rather
than run a long command in PowerShell each time, I bundled everything up into a
quick function that I can run using <code>New-StaticZipFile</code>.</p><p>The <code>Compress-Archive</code> cmdlet lets us create a compressed, or zipped, archive
file. There are limitations (e.g. maximum file size is 2GB) to this cmdlet, as
well as more advanced options, such as the level of compression needed, but
we&rsquo;ll be keeping it <em>really</em> simple here.</p><pre><code>NAME
    Compress-Archive

SYNOPSIS
    Creates a compressed archive, or zipped file, from specified files and
    directories.

SYNTAX
    Compress-Archive [-Path] &lt;System.String[]&gt; [-DestinationPath] &lt;System.String&gt; [-CompressionLevel {Optimal | NoCompression |
    Fastest}] -Force [-PassThru] [-Confirm] [-WhatIf] [&lt;CommonParameters&gt;]
</code></pre><p>The <code>Path</code> argument we pass will be a list of the static files which we want
to add to our <code>.zip</code> file. So, to begin our function we&rsquo;ll create and populate
this list.</p><div class=highlight><pre class=chroma><code class=language-powershell data-lang=powershell><span class=nv>$Files</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>-TypeName</span> <span class=s1>&#39;System.Collections.ArrayList&#39;</span>
<span class=nv>$Files</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=s1>&#39;C:\Users\StuartMcColl\OneDrive\Documents\Document.docx&#39;</span><span class=p>)</span>
<span class=nv>$Files</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=s1>&#39;C:\Users\StuartMcColl\OneDrive\Documents\Worksheet.xlsx&#39;</span><span class=p>)</span>
</code></pre></div><p>With our list of static files populated, we&rsquo;re ready for them to be compressed.
We&rsquo;ll also need to tell the <code>Compress-Archive</code> cmdlet where to put them, e.g.
the path to our newly-created archive, which we do using the <code>DestinationPath</code>
parameter.</p><div class=highlight><pre class=chroma><code class=language-powershell data-lang=powershell><span class=nb>Compress-Archive</span> <span class=n>-Path</span> <span class=p>$(</span><span class=n>Files</span><span class=p>)</span> <span class=n>-DestinationPath</span> <span class=s1>&#39;C:\Users\StuartMcColl\OneDrive\Documents\MyArchive.zip&#39;</span>
</code></pre></div><p>Altogether, the function so far looks like:</p><div class=highlight><pre class=chroma><code class=language-powershell data-lang=powershell><span class=k>function</span> <span class=nb>New-StaticZipFile</span>
<span class=p>{</span>
  <span class=nv>$Files</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>-TypeName</span> <span class=s1>&#39;System.Collections.ArrayList&#39;</span>
  <span class=nv>$Files</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=s1>&#39;C:\Users\StuartMcColl\OneDrive\Documents\Document.docx&#39;</span><span class=p>)</span>
  <span class=nv>$Files</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=s1>&#39;C:\Users\StuartMcColl\OneDrive\Documents\Worksheet.xlsx&#39;</span><span class=p>)</span>
  <span class=nb>Compress-Archive</span> <span class=n>-Path</span> <span class=p>$(</span><span class=n>Files</span><span class=p>)</span> <span class=n>-DestinationPath</span> <span class=s1>&#39;C:\Users\StuartMcColl\OneDrive\Documents\MyArchive.zip&#39;</span>
<span class=p>}</span>
</code></pre></div><p>This will work absolutely fine - on the first run. In your terminal, you&rsquo;ll see
the following output:</p><pre><code>0
1
</code></pre><p>These numbers are output when we add to our <code>$Files</code> list. If we then run a
<code>Get-Item .\*</code> command, the output will be:</p><pre><code>        Directory: C:\Users\StuartMcColl\Documents\


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
la---        28/05/2022     11:54           5475   MyArchive.zip
la---        28/05/2022     11:42              0   Document.docx
la---        28/05/2022     11:42           6191   Worksheet.xlsx
</code></pre><p>We can see that we&rsquo;ve successfully created <code>MyArchive.zip</code>. If we run the
<code>New-StaticZipFile</code> function again, we&rsquo;ll be met with the following error:</p><pre><code>The archive file C:\Users\StuartMcColl\OneDrive\Documents\MyArchive.zip already
exists. Use the -Update parameter to update the existing archive file or use
the -Force parameter to overwrite the existing archive file.
</code></pre><p>We <em>could</em> use the <code>Compress-Archive</code> cmdlet to update any existing
<code>MyArchive.zip</code> file if we find one, but for my use case I&rsquo;m happy to remove
any existing file and simply create a new one. Rather than simply <code>-Force</code> the
overwrite of the existing archive file, I also want to <em>know</em> that there was
already a <code>MyArchive.zip</code> file before I remove it.</p><div class=highlight><pre class=chroma><code class=language-powershell data-lang=powershell><span class=k>If</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=n>-Path</span> <span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>StuartMcColl</span><span class=p>\</span><span class=n>OneDrive</span><span class=p>\</span><span class=n>Documents</span><span class=p>\</span><span class=n>MyArchive</span><span class=p>.</span><span class=n>zip</span> <span class=n>-PathType</span> <span class=n>Leaf</span><span class=p>)</span>
<span class=p>{</span>
  <span class=nb>Write-Host</span> <span class=s1>&#39;Deleting existing MyArchive.zip file&#39;</span>
  <span class=nb>Remove-Item</span> <span class=n>-Path</span> <span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>StuartMcColl</span><span class=p>\</span><span class=n>OneDrive</span><span class=p>\</span><span class=n>Documents</span><span class=p>\</span><span class=n>MyArchive</span><span class=p>.</span><span class=n>zip</span>
<span class=p>}</span>
</code></pre></div><p>Altogether, with some additional output gives us:</p><div class=highlight><pre class=chroma><code class=language-powershell data-lang=powershell><span class=k>function</span> <span class=nb>New-StaticZipFile</span>
<span class=p>{</span>
  <span class=nb>Write-Host</span> <span class=s1>&#39;Creating new MyArchive.zip file&#39;</span>

  <span class=nv>$Files</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>-TypeName</span> <span class=s1>&#39;System.Collections.ArrayList&#39;</span>
  <span class=nv>$Files</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=s1>&#39;C:\Users\StuartMcColl\OneDrive\Documents\Document.docx&#39;</span><span class=p>)</span>
  <span class=nv>$Files</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=s1>&#39;C:\Users\StuartMcColl\OneDrive\Documents\Worksheet.xlsx&#39;</span><span class=p>)</span>

  <span class=k>If</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=n>-Path</span> <span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>StuartMcColl</span><span class=p>\</span><span class=n>OneDrive</span><span class=p>\</span><span class=n>Documents</span><span class=p>\</span><span class=n>MyArchive</span><span class=p>.</span><span class=n>zip</span> <span class=n>-PathType</span> <span class=n>Leaf</span><span class=p>)</span>
  <span class=p>{</span>
    <span class=nb>Write-Host</span> <span class=s1>&#39;Deleting existing MyArchive.zip file&#39;</span>
    <span class=nb>Remove-Item</span> <span class=n>-Path</span> <span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>StuartMcColl</span><span class=p>\</span><span class=n>OneDrive</span><span class=p>\</span><span class=n>Documents</span><span class=p>\</span><span class=n>MyArchive</span><span class=p>.</span><span class=n>zip</span>
  <span class=p>}</span>

  <span class=nb>Compress-Archive</span> <span class=n>-Path</span> <span class=p>$(</span><span class=n>Files</span><span class=p>)</span> <span class=n>-DestinationPath</span> <span class=s1>&#39;C:\Users\StuartMcColl\OneDrive\Documents\MyArchive.zip&#39;</span>

  <span class=nb>Write-Host</span> <span class=s1>&#39;Finished creating new MyArchive.zip file&#39;</span>
<span class=p>}</span>
</code></pre></div></div></article></main></div><hr><footer><section><h3>More</h3><ul><li><a href=https://hachyderm.io/@stuartmccoll rel=me>Contact me on Mastodon</a></li><li>Spotted a bug in the site?
<a href=https://github.com/stuartmccoll/hugo-theme-refresh/issues/new>Raise an issue on GitHub</a></li><li>Get notifications of new posts by
<a href=https://stuartmccoll.github.io/index.xml>subscribing to my RSS feed</a></li><li>This static site was generated using
<a href=https://github.com/gohugoio/hugo/releases/tag/v0.83.1>Hugo version 0.83.1</a></li></ul></section><hr><section><h3>Attribution</h3><p xmlns:dct=http://purl.org/dc/terms/ xmlns:cc=http://creativecommons.org/ns# class=license-text>This blog post <span rel=dct:title>(Use PowerShell to create a .zip file)</span> is licensed under
<a href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a>. Any code contained within
this article may be subject to other licenses.</p></section></footer></div></body></html>