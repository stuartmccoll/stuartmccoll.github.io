<!DOCTYPE html>
<html lang="en-GB">

    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="Stuart McColl ">
<meta name="description"
    content="Last week I wrote another AppleScript for automating a manual task I have to carry out each time I switch between my personal MacBook Pro and my work device. This time, I needed to write a script which would connect to my Bluetooth devices - a Magic Mouse, Magic Keyboard and my AirPods.
Rather than accessing the System Preferences application, which I demonstrated in my last AppleScript, this script needed to directly access the Bluetooth icon in the menu bar." />
<meta name="keywords" content="homepage, blog, development, programming" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="/posts/2020-05-02-applescript-bluetooth-devices/" />
<title>
    AppleScript for Connecting Bluetooth Devices ::  
</title>
<link rel="stylesheet" href="/main.min.9b276610b5993837f29d9c1e20b9e04db4f387b683b8034a6bf96f7fbfad81dc.css"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
<link rel="shortcut icon" href="/favicon.ico">
<meta name="theme-color" content="#252627"><meta itemprop="name" content="AppleScript for Connecting Bluetooth Devices">
<meta itemprop="description" content="Last week I wrote another AppleScript for automating a manual task I have to carry out each time I switch between my personal MacBook Pro and my work device. This time, I needed to write a script which would connect to my Bluetooth devices - a Magic Mouse, Magic Keyboard and my AirPods.
Rather than accessing the System Preferences application, which I demonstrated in my last AppleScript, this script needed to directly access the Bluetooth icon in the menu bar.">
<meta itemprop="datePublished" content="2020-05-02T10:50:44&#43;01:00" />
<meta itemprop="dateModified" content="2020-05-02T10:50:44&#43;01:00" />
<meta itemprop="wordCount" content="595">
<meta itemprop="image" content="/"/>



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/"/>

<meta name="twitter:title" content="AppleScript for Connecting Bluetooth Devices"/>
<meta name="twitter:description" content="Last week I wrote another AppleScript for automating a manual task I have to carry out each time I switch between my personal MacBook Pro and my work device. This time, I needed to write a script which would connect to my Bluetooth devices - a Magic Mouse, Magic Keyboard and my AirPods.
Rather than accessing the System Preferences application, which I demonstrated in my last AppleScript, this script needed to directly access the Bluetooth icon in the menu bar."/>

<meta property="article:published_time" content="2020-05-02 10:50:44 &#43;0100 BST" />
    </head>

    <body>
        <div class="container">
            <header>
    <section>
        <h1 class="site-heading"></h1>
        <nav>
            <ul>
                <li><a href="/">Blog</a></li>
                <li><a href="/about">About</a></li>
            </ul>
        </nav>
    </section>
</header>

<hr />

            <div class="content">
                
<main class="post">

    <article>
        <header>
            <h1 class="post-title">AppleScript for Connecting Bluetooth Devices</h1>
            <p class="post-date">May 2, 2020</p>
        </header>

        <hr class="post-rule" />

        <div class="post-content">
            <p>Last week I wrote another AppleScript for automating a manual task I have to carry out each time I switch between my personal MacBook Pro and my work device. This time, I needed
to write a script which would connect to my Bluetooth devices - a Magic Mouse, Magic Keyboard and my AirPods.</p>
<p>Rather than accessing the System Preferences application, which I demonstrated in <a href="/posts/2020-04-27-applescript-external-displays">my last AppleScript</a>, this script needed to directly access the Bluetooth icon in the
menu bar. If you&rsquo;re repurposing anything within this script, you&rsquo;ll need to make sure that you have the Bluetooth icon within your own menu bar.</p>
<div class="highlight"><pre class="chroma"><code class="language-applescript" data-lang="applescript"><span class="c">-- Subroutine to connect to Bluetooth devices</span>
<span class="c">-- @param bluetooth_devices : List(String) - the device names</span>
<span class="k">on</span> <span class="nv">connect_bluetooth_devices</span><span class="p">(</span><span class="nv">bluetooth_devices</span><span class="p">)</span>
    <span class="p">...</span>
<span class="k">end</span> <span class="nv">connect_bluetooth_devices</span></code></pre></div>
<p>I&rsquo;ve written a <a href="https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/conceptual/ASLR_about_handlers.html#//apple_ref/doc/uid/TP40000983-CH206-SW3">handler</a> (think &lsquo;function&rsquo;), which takes an array of Bluetooth device names. The idea here is that we&rsquo;ll pass all of the Bluetooth devices which we want
to connect to into the handler, loop through them and for each one connect to it using the Bluetooth icon in the menu bar.</p>
<div class="highlight"><pre class="chroma"><code class="language-applescript" data-lang="applescript"><span class="nb">activate</span> <span class="nb">application</span> <span class="s2">&#34;SystemUIServer&#34;</span></code></pre></div>
<p>SystemUIServer is responsible for the system tray side of the menu bar - things like Bluetooth, Networking, Clock, etc.</p>
<div class="highlight"><pre class="chroma"><code class="language-applescript" data-lang="applescript"><span class="k">tell</span> <span class="nb">application</span> <span class="s2">&#34;System Events&#34;</span> <span class="k">to</span> <span class="k">tell</span> <span class="nv">process</span> <span class="s2">&#34;SystemUIServer&#34;</span>
    <span class="p">...</span>
<span class="k">end</span> <span class="k">tell</span></code></pre></div>
<p>This is us enabling ourselves to be able to access items within the menu bar.</p>
<div class="highlight"><pre class="chroma"><code class="language-applescript" data-lang="applescript"><span class="k">set</span> <span class="nv">bluetooth_menu_bar_item</span> <span class="k">to</span> <span class="p">(</span><span class="na">menu</span> <span class="nv">bar</span> <span class="nb">item</span> <span class="mi">1</span> <span class="k">of</span> <span class="na">menu</span> <span class="nv">bar</span> <span class="mi">1</span> <span class="nb">whose</span> <span class="nv">description</span> <span class="ow">contains</span> <span class="s2">&#34;bluetooth&#34;</span><span class="p">)</span>
<span class="k">tell</span> <span class="nv">bluetooth_menu_bar_item</span>
    <span class="p">...</span>
<span class="k">end</span> <span class="k">tell</span></code></pre></div>
<p>Here, we&rsquo;re getting the Bluetooth menu bar item and setting it to a variable.</p>
<div class="highlight"><pre class="chroma"><code class="language-applescript" data-lang="applescript"><span class="k">repeat</span> <span class="k">with</span> <span class="nv">bluetooth_device</span> <span class="k">in</span> <span class="nv">bluetooth_devices</span>

<span class="k">end</span> <span class="k">repeat</span></code></pre></div>
<p>This is the loop I mentioned earlier - we&rsquo;re looping through each item in the array, and assigning the item to the <code>bluetooth_device</code> variable.</p>
<div class="highlight"><pre class="chroma"><code class="language-applescript" data-lang="applescript"><span class="nv">click</span>
<span class="k">if</span> <span class="nb">exists</span> <span class="na">menu</span> <span class="nb">item</span> <span class="nv">bluetooth_device</span> <span class="k">of</span> <span class="na">menu</span> <span class="mi">1</span> <span class="k">then</span>
    <span class="k">tell</span> <span class="p">(</span><span class="na">menu</span> <span class="nb">item</span> <span class="nv">bluetooth_device</span> <span class="k">of</span> <span class="na">menu</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nv">click</span>
        <span class="k">if</span> <span class="nb">exists</span> <span class="na">menu</span> <span class="nb">item</span> <span class="s2">&#34;Connect&#34;</span> <span class="k">of</span> <span class="na">menu</span> <span class="mi">1</span> <span class="k">then</span>
            <span class="nv">click</span> <span class="na">menu</span> <span class="nb">item</span> <span class="s2">&#34;Connect&#34;</span> <span class="k">of</span> <span class="na">menu</span> <span class="mi">1</span>
        <span class="k">else</span>
            <span class="c">-- Exit Bluetooth menu bar item</span>
            <span class="na">key code</span> <span class="mi">53</span>
        <span class="k">end</span> <span class="k">if</span>
    <span class="k">end</span> <span class="k">tell</span>
<span class="k">end</span> <span class="k">if</span></code></pre></div>
<p>This is really the bulk of the script. We <code>click</code> the Bluetooth menu bar icon. We then check whether our <code>bluetooth_device</code> is present in the list that is displayed. If it is,
then we click the device name. If the submenu that opens contains a <code>Connect</code> option, then we click it. Otherwise, we use <code>key code 53</code> (Escape), to exit the menu.</p>
<p>After exiting our loop we hit <code>key code 53</code> one last time to ensure that we&rsquo;ve closed the Bluetooth menu.</p>
<p>We can call our handler like so:</p>
<div class="highlight"><pre class="chroma"><code class="language-applescript" data-lang="applescript"><span class="nv">connect_bluetooth_devices</span><span class="p">({</span><span class="s2">&#34;Stuart’s AirPods&#34;</span><span class="p">,</span> <span class="s2">&#34;Stuart’s Keyboard&#34;</span><span class="p">,</span> <span class="s2">&#34;Stuart’s Mouse&#34;</span><span class="p">})</span></code></pre></div>
<p>The important thing to note here is the difference between the <code>’</code> character used in the device name string and the <code>'</code> character on your keyboard.</p>
<p>Here&rsquo;s the script in full:</p>
<div class="highlight"><pre class="chroma"><code class="language-applescript" data-lang="applescript"><span class="c">-- Connect to Bluetooth devices</span>
<span class="nv">connect_bluetooth_devices</span><span class="p">({</span><span class="s2">&#34;Stuart’s AirPods&#34;</span><span class="p">,</span> <span class="s2">&#34;Stuart’s Keyboard&#34;</span><span class="p">,</span> <span class="s2">&#34;Stuart’s Mouse&#34;</span><span class="p">})</span>

<span class="c">-- Handler to connect to Bluetooth devices</span>
<span class="c">-- @param bluetooth_devices : List(String) - the device names</span>
<span class="k">on</span> <span class="nv">connect_bluetooth_devices</span><span class="p">(</span><span class="nv">bluetooth_devices</span><span class="p">)</span>
	<span class="nb">activate</span> <span class="nb">application</span> <span class="s2">&#34;SystemUIServer&#34;</span>
	<span class="k">tell</span> <span class="nb">application</span> <span class="s2">&#34;System Events&#34;</span> <span class="k">to</span> <span class="k">tell</span> <span class="nv">process</span> <span class="s2">&#34;SystemUIServer&#34;</span>
		<span class="k">set</span> <span class="nv">bluetooth_menu_bar_item</span> <span class="k">to</span> <span class="p">(</span><span class="na">menu</span> <span class="nv">bar</span> <span class="nb">item</span> <span class="mi">1</span> <span class="k">of</span> <span class="na">menu</span> <span class="nv">bar</span> <span class="mi">1</span> <span class="nb">whose</span> <span class="nv">description</span> <span class="ow">contains</span> <span class="s2">&#34;bluetooth&#34;</span><span class="p">)</span>
		<span class="k">tell</span> <span class="nv">bluetooth_menu_bar_item</span>
			<span class="k">repeat</span> <span class="k">with</span> <span class="nv">bluetooth_device</span> <span class="k">in</span> <span class="nv">bluetooth_devices</span>
				<span class="nv">click</span>
				<span class="k">if</span> <span class="nb">exists</span> <span class="na">menu</span> <span class="nb">item</span> <span class="nv">bluetooth_device</span> <span class="k">of</span> <span class="na">menu</span> <span class="mi">1</span> <span class="k">then</span>
					<span class="k">tell</span> <span class="p">(</span><span class="na">menu</span> <span class="nb">item</span> <span class="nv">bluetooth_device</span> <span class="k">of</span> <span class="na">menu</span> <span class="mi">1</span><span class="p">)</span>
						<span class="nv">click</span>
						<span class="k">if</span> <span class="nb">exists</span> <span class="na">menu</span> <span class="nb">item</span> <span class="s2">&#34;Connect&#34;</span> <span class="k">of</span> <span class="na">menu</span> <span class="mi">1</span> <span class="k">then</span>
							<span class="nv">click</span> <span class="na">menu</span> <span class="nb">item</span> <span class="s2">&#34;Connect&#34;</span> <span class="k">of</span> <span class="na">menu</span> <span class="mi">1</span>
						<span class="k">else</span>
							<span class="c">-- Exit Bluetooth menu bar item</span>
							<span class="na">key code</span> <span class="mi">53</span>
						<span class="k">end</span> <span class="k">if</span>
					<span class="k">end</span> <span class="k">tell</span>
				<span class="k">end</span> <span class="k">if</span>
			<span class="k">end</span> <span class="k">repeat</span>
			<span class="c">-- Exit Bluetooth menu bar item</span>
			<span class="na">key code</span> <span class="mi">53</span>
		<span class="k">end</span> <span class="k">tell</span>
	<span class="k">end</span> <span class="k">tell</span>
<span class="k">end</span> <span class="nv">connect_bluetooth_devices</span></code></pre></div>

        </div>
    </article>

</main>

            </div>

            

            <hr />

            <footer>
    
    
    
    <section>
        <h3>Share this content</h3>
        <p>
            <a
                href="https://twitter.com/intent/tweet?url=https://stuartmccoll.github.io%2fposts%2f2020-05-02-applescript-bluetooth-devices%2f&via=itstuartmccoll&text=I%27m%20reading">
                Tweet this blog post
            </a>
        </p>
    </section>
    <hr />
    
    
    
    <section>
        <h3>More</h3>
        <ul>
            
            <li>
                <a
                    href="https://twitter.com/intent/tweet?text=%40itstuartmccoll%20Hello%2C%20%3Cinsert%20message%20here%3E">
                    Contact me on Twitter
                </a>
            </li>
            
            
            <li>Spotted a bug in the site?
                <a href="https://github.com/stuartmccoll/hugo-theme-refresh/issues/new">
                    Raise an issue on GitHub
                </a>
            </li>
            
            <li>Get notifications of new posts by
                <a href="//index.xml">
                    subscribing to my RSS feed
                </a>
            </li>
            
            <li>This static site was generated using
                <a href="https://github.com/gohugoio/hugo/releases/tag/v0.70.0">
                    Hugo version 0.70.0
                </a>
            </li>
            
        </ul>
    </section>
    <hr />
    
    <section>
        <h3>Attribution</h3>
        <p xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#" class="license-text">
            
            This blog post <span rel="dct:title">(AppleScript for Connecting Bluetooth Devices)</span> is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0">CC BY 4.0</a>. Any code contained within
            this article may be subject to other licenses.
            
        </p>
    </section>
    
</footer>

            
        </div>
    </body>

</html>